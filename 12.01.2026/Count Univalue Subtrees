def countUnivalSubtrees(root):
    count = 0
    def dfs(node):
        nonlocal count
        if not node:
            return True
        left = dfs(node.left)
        right = dfs(node.right)
        if left and right and \
           (not node.left or node.left.val == node.val) and \
           (not node.right or node.right.val == node.val):
            count += 1
            return True
        return False
    dfs(root)
    return count
